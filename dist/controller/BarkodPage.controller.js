sap.ui.define(["com/bizim/depotransfer/ZMM007_DEPO_TRANSFER/controller/BaseController","sap/m/MessageToast","sap/ui/model/Filter","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","sap/ui/model/FilterOperator","com/bizim/depotransfer/ZMM007_DEPO_TRANSFER/model/formatter","sap/m/MessageBox"],function(e,a,r,t,i,o,s,d){"use strict";var l="";return e.extend("com.bizim.depotransfer.ZMM007_DEPO_TRANSFER.controller.BarkodPage",{formatter:s,onInit:function(){var e=new t({busy:false,delay:0});this.tableData=[];this.getRouter().getRoute("BarkodPage").attachPatternMatched(this._onRouteMatched,this);this.getView().setModel(e);this.setModel(e,"ParkodPageView");e.setData(this.tableData)},onValueHelpBtnBarkod:function(e){if(!this._BarkodSH){this._BarkodSH=sap.ui.xmlfragment("com.bizim.depotransfer.ZMM007_DEPO_TRANSFER.fragments.BarkodSH",this)}this.oViewModel=this.getOwnerComponent().getModel("ParkodPageView");sap.ui.getCore().setModel(this.oViewModel,"ParkodPageView");var a=this.getModel("ParkodPageView");a.setProperty("/dialogbusy",true);var r=new sap.ui.model.odata.ODataModel("/sap/opu/odata/SAP/ZMM007_TRANSFER_RF_SRV/",true);r.read("/Zmm009FmShBarkodSet",{success:function(e){a.setProperty("/Zmm009FmShBarkod",e.results)},error:function(e){try{var a=JSON.parse(e.responseText);a=a.error.message.value}catch(r){a=e.message}sap.m.MessageBox.alert(a,{icon:sap.m.MessageBox.Icon.ERROR,title:"Hata Oluştu!"});sap.ui.core.BusyIndicator.hide(0)}});this.getView().addDependent(this._BarkodSH);this._BarkodSH.open()},_handleValueHelpSearchBarkod:function(e){var a=e.getParameter("value");var t=new r({filters:[new r("Ean11",sap.ui.model.FilterOperator.Contains,a),new r("Matnr",sap.ui.model.FilterOperator.Contains,a),new r("Maktx",sap.ui.model.FilterOperator.Contains,a)],and:false});e.getSource().getBinding("items").filter(t)},_handleValueHelpCloseBarkod:function(e){var a=this;var r=e.getParameter("selectedItem");if(r){a.getView().byId("idBarkod").setValue(r.getTitle())}e.getSource().getBinding("items").filter([])},_onRefreshTable:function(e){var a=this.getModel("ParkodPageView");var r=new sap.ui.model.odata.ODataModel("/sap/opu/odata/SAP/ZMM007_TRANSFER_RF_SRV/",true);var t=new Array;var i=new sap.ui.model.Filter("VbelnVl",sap.ui.model.FilterOperator.EQ,l.GondTeslimat);t.push(i);var o=new sap.ui.model.Filter("Xblnr",sap.ui.model.FilterOperator.EQ,l.Eirsaliye);t.push(o);var s=new sap.ui.model.Filter("Lifex",sap.ui.model.FilterOperator.EQ,l.MatbuIrsaliye);t.push(s);var d=new sap.ui.model.Filter("PCheck",sap.ui.model.FilterOperator.EQ,"X");t.push(d);r.read("/CheckXSet",{filters:t,success:function(e){for(var r=0;r<e.results.length;r++){if(e.results[r].Vfdat){e.results[r].Vfdat=e.results[r].Vfdat.toLocaleDateString()}}a.setProperty("/",e.results)},error:function(e){var a=JSON.parse(e.response.body);sap.m.MessageBox.show(a.error.message.value,{icon:sap.m.MessageBox.Icon.ERROR,duration:9e3,width:"20em"})}})},_onRouteMatched:function(e){var a=this.getModel("ParkodPageView");var r=e.getParameter("arguments");this.type=r.Type;l=JSON.parse(r.data);var t=new sap.ui.model.odata.ODataModel("/sap/opu/odata/SAP/ZMM007_TRANSFER_RF_SRV/",true);var i=new Array;var o=new sap.ui.model.Filter("VbelnVl",sap.ui.model.FilterOperator.EQ,l.GondTeslimat);i.push(o);var s=new sap.ui.model.Filter("Xblnr",sap.ui.model.FilterOperator.EQ,l.Eirsaliye);i.push(s);var d=new sap.ui.model.Filter("Lifex",sap.ui.model.FilterOperator.EQ,l.MatbuIrsaliye);i.push(d);var n=new sap.ui.model.Filter("PCheck",sap.ui.model.FilterOperator.EQ,"X");i.push(n);t.read("/CheckXSet",{filters:i,success:function(e){for(var r=0;r<e.results.length;r++){if(e.results[r].Vfdat){e.results[r].Vfdat=e.results[r].Vfdat.toLocaleDateString()}}a.setProperty("/",e.results)},error:function(e){var a=JSON.parse(e.response.body);sap.m.MessageBox.show(a.error.message.value,{icon:sap.m.MessageBox.Icon.ERROR,duration:9e3,width:"20em"})}})},onOkutulmayanBarkodlar:function(){var e=this;var a=this.getModel("ParkodPageView");a.setProperty("/BarkodTitle","Eksik Barkodlar");var r=new sap.ui.model.odata.ODataModel("/sap/opu/odata/SAP/ZMM007_TRANSFER_RF_SRV/",true);if(e.getView("ParkodPageView").byId("idMiktar").getValue()===""){var t="0.0"}else{t=e.getView("ParkodPageView").byId("idMiktar").getValue()}if(e.getView("ParkodPageView").byId("idFazlaMiktar").getValue()===""){var i="0.0"}else{i=e.getView("ParkodPageView").byId("idFazlaMiktar").getValue()}if(e.getView("ParkodPageView").byId("idHasarliMik").getValue()===""){var o="0.0"}else{o=e.getView("ParkodPageView").byId("idHasarliMik").getValue()}var s=[];var d={};var n={VbelnVl:l.GondTeslimat,Xblnr:l.Eirsaliye,Lifex:l.MatbuIrsaliye,Ean11:e.getView("ParkodPageView").byId("idBarkod").getValue(),Zzmiktar:t,Zzfazla:i,Zzhasarli:o,Charg:""};s.push(n);d.to_BarkodItem=s;d.to_BarkodList=[];d.PBlist="OKUTULMAYAN";r.create("/BarkodHeaderSet",d,{success:function(r){a.setProperty("/Barkodlar",r.to_BarkodList.results);e.openFragment()},error:function(e){var a=JSON.parse(e.response.body);sap.m.MessageBox.show(a.error.message.value,{icon:sap.m.MessageBox.Icon.ERROR,duration:9e3,width:"20em"});sap.ui.core.BusyIndicator.hide(0)}})},onEksikBarkodlar:function(){var e=this;var a=this.getModel("ParkodPageView");a.setProperty("/BarkodTitle","Eksik Barkodlar");var r=new sap.ui.model.odata.ODataModel("/sap/opu/odata/SAP/ZMM007_TRANSFER_RF_SRV/",true);if(e.getView("ParkodPageView").byId("idMiktar").getValue()===""){var t="0.0"}else{t=e.getView("ParkodPageView").byId("idMiktar").getValue()}if(e.getView("ParkodPageView").byId("idFazlaMiktar").getValue()===""){var i="0.0"}else{i=e.getView("ParkodPageView").byId("idFazlaMiktar").getValue()}if(e.getView("ParkodPageView").byId("idHasarliMik").getValue()===""){var o="0.0"}else{o=e.getView("ParkodPageView").byId("idHasarliMik").getValue()}var s=[];var d={};var n={VbelnVl:l.GondTeslimat,Xblnr:l.Eirsaliye,Lifex:l.MatbuIrsaliye,Ean11:e.getView("ParkodPageView").byId("idBarkod").getValue(),Zzmiktar:t,Zzfazla:i,Zzhasarli:o,Charg:""};s.push(n);d.to_BarkodItem=s;d.to_BarkodList=[];d.PBlist="EKSIK";r.create("/BarkodHeaderSet",d,{success:function(r){a.setProperty("/Barkodlar",r.to_BarkodList.results);e.openFragment()},error:function(e){var a=JSON.parse(e.response.body);sap.m.MessageBox.show(a.error.message.value,{icon:sap.m.MessageBox.Icon.ERROR,duration:9e3,width:"20em"});sap.ui.core.BusyIndicator.hide(0)}})},onFazlaBarkodlar:function(){var e=this;var a=this.getModel("ParkodPageView");a.setProperty("/BarkodTitle","Eksik Barkodlar");var r=new sap.ui.model.odata.ODataModel("/sap/opu/odata/SAP/ZMM007_TRANSFER_RF_SRV/",true);if(e.getView("ParkodPageView").byId("idMiktar").getValue()===""){var t="0.0"}else{t=e.getView("ParkodPageView").byId("idMiktar").getValue()}if(e.getView("ParkodPageView").byId("idFazlaMiktar").getValue()===""){var i="0.0"}else{i=e.getView("ParkodPageView").byId("idFazlaMiktar").getValue()}if(e.getView("ParkodPageView").byId("idHasarliMik").getValue()===""){var o="0.0"}else{o=e.getView("ParkodPageView").byId("idHasarliMik").getValue()}var s=[];var d={};var n={VbelnVl:l.GondTeslimat,Xblnr:l.Eirsaliye,Lifex:l.MatbuIrsaliye,Ean11:e.getView("ParkodPageView").byId("idBarkod").getValue(),Zzmiktar:t,Zzfazla:i,Zzhasarli:o,Charg:""};s.push(n);d.to_BarkodItem=s;d.to_BarkodList=[];d.PBlist="FAZLA";r.create("/BarkodHeaderSet",d,{success:function(r){a.setProperty("/Barkodlar",r.to_BarkodList.results);e.openFragment()},error:function(e){var a=JSON.parse(e.response.body);sap.m.MessageBox.show(a.error.message.value,{icon:sap.m.MessageBox.Icon.ERROR,duration:9e3,width:"20em"});sap.ui.core.BusyIndicator.hide(0)}})},openFragment:function(){if(!this._Barkod){this._Barkod=sap.ui.xmlfragment("com.bizim.depotransfer.ZMM007_DEPO_TRANSFER.fragments.Barkodlar",this)}this.getView().addDependent(this._Barkod);jQuery.sap.syncStyleClass("sapUiSizeCompact",this.getView(),this._Barkod);this._Barkod.open()},onBarkodTemp:function(){var e=this;var a="";var r=this.getModel("ParkodPageView");var t=new sap.ui.model.odata.ODataModel("/sap/opu/odata/SAP/ZMM007_TRANSFER_RF_SRV/",true);if(e.getView("ParkodPageView").byId("idMiktar").getValue()===""){var i="0.0"}else{i=e.getView("ParkodPageView").byId("idMiktar").getValue()}if(e.getView("ParkodPageView").byId("idFazlaMiktar").getValue()===""){var o="0.0"}else{o=e.getView("ParkodPageView").byId("idFazlaMiktar").getValue()}if(e.getView("ParkodPageView").byId("idHasarliMik").getValue()===""){var s="0.0"}else{s=e.getView("ParkodPageView").byId("idHasarliMik").getValue()}a=t.createKey("/GetBarkodTempSet",{PTemp:"X",Xblnr:l.Eirsaliye,Lifex:l.MatbuIrsaliye,VbelnVl:l.GondTeslimat,Ean11:e.getView("ParkodPageView").byId("idBarkod").getValue(),Zzmiktar:i,Zzfazla:o,Zzhasarli:s});sap.ui.core.BusyIndicator.show(0);t.read(a,{success:function(a){sap.ui.core.BusyIndicator.hide();if(a.Matnr){e._onRefreshTable()}e.getView().getModel("ParkodPageView").refresh(true);e.byId("idBarkod").setValue("");e.byId("idMiktar").setValue("");e.byId("idFazlaMiktar").setValue("");e.byId("idHasarliMik").setValue("")},error:function(e){sap.ui.core.BusyIndicator.hide();var a=JSON.parse(e.response.body);sap.m.MessageBox.show(a.error.message.value,{icon:sap.m.MessageBox.Icon.ERROR,duration:9e3,width:"20em"})}})},onBack:function(){history.go(-1)},onDialogCloseButton:function(){this._Barkod.close()},onDelete:function(){var e=this;if(this.byId("idTable").getSelectedContextPaths().length===0){sap.m.MessageBox.show("Lütfen silinecek satır seçiniz.",{icon:sap.m.MessageBox.Icon.ERROR,duration:9e3,width:"20em"})}else{var a=[];var r={};r.PSil="X";var t=e.byId("idTable");for(var i=0;i<e.byId("idTable").getSelectedContextPaths().length;i++){var o={VbelnVl:t.getSelectedContexts()[0].oModel.oData[i].VbelnVl,Matnr:t.getSelectedContexts()[0].oModel.oData[i].Matnr};a.push(o)}r.to_DeleteHeader=a;var s=new sap.ui.model.odata.ODataModel("/sap/opu/odata/SAP/ZMM007_TRANSFER_RF_SRV/",true);s.create("/DeleteHeaderSet",r,{success:function(a){if(a.Message){sap.m.MessageBox.show(a.Message,{icon:sap.m.MessageBox.Icon.SUCCESS,duration:9e3,width:"20em"})}e.byId("idTable").getSelectedContextPaths().reverse().map(function(a){e.getView().getModel("ParkodPageView").getData().splice(a.slice(1,2),1)});e.byId("idTable").removeSelections();e.getView().getModel("ParkodPageView").refresh(true)},error:function(e){var a=JSON.parse(e.response.body);sap.m.MessageBox.show(a.error.message.value,{icon:sap.m.MessageBox.Icon.ERROR,duration:9e3,width:"20em"});sap.ui.core.BusyIndicator.hide(0)}})}},onSave:function(){var e=this;var a=this.getModel("ParkodPageView");var r=[];var t={};var i=a.getProperty("/");t.PSave="X";for(var o=0;o<i.length;o++){var s={VbelnVl:i[o].VbelnVl,Posnr:i[o].Posnr,Matnr:i[o].Matnr,Arktx:"",Zzmiktar:i[o].Zzmiktar,Del:""};r.push(s)}t.to_SaveItem=r;var d=new sap.ui.model.odata.ODataModel("/sap/opu/odata/SAP/ZMM007_TRANSFER_RF_SRV/",true);d.create("/SaveHeaderSet",t,{success:function(r){if(r.Message){sap.m.MessageBox.show(r.Message,{icon:sap.m.MessageBox.Icon.SUCCESS,duration:9e3,width:"20em"})}e.tableItemData={};e.tableData=[];a.setData(e.tableData)},error:function(e){var a=JSON.parse(e.response.body);sap.m.MessageBox.show(a.error.message.value,{icon:sap.m.MessageBox.Icon.ERROR,duration:9e3,width:"20em"});sap.ui.core.BusyIndicator.hide(0)}})}})});